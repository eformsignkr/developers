

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>eformsign Webhook 사용하기 &mdash; eformsign API guide 2021.10.15 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/code-tabs.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/code-tabs.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="eformsign API 사용하기" href="eformsign_api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/forcs_b.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="eformsign_api_overview.html">개요</a></li>
<li class="toctree-l1"><a class="reference internal" href="eformsign_embedding.html">eformsign 기능 직접 삽입하기</a></li>
<li class="toctree-l1"><a class="reference internal" href="eformsign_api.html">eformsign API 사용하기</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">eformsign Webhook 사용하기</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">시작하기</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#webhook">Webhook 키 발급하기</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id3">서명 생성하기</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#java">Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#php">PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">각 언어별 예제</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Webhook 제공 리스트</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">Webhook 관련 정보</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">문서 이벤트</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdf">PDF 생성 이벤트</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">eformsign API guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>eformsign Webhook 사용하기</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/help/eformsign_webhook.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="eformsign-webhook">
<h1>eformsign Webhook 사용하기<a class="headerlink" href="#eformsign-webhook" title="Permalink to this headline">¶</a></h1>
<p>eformsign에 이벤트가 발생했을 때 발생한 이벤트의 정보를 고객 시스템/서비스로 알려주는 기능입니다. Webhook을 설정하면, 고객의 Webhook endpoint로 해당 이벤트 정보를 HTTP POST형식으로 알려 줍니다.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Webhook의 endpoint는 고객의 client callback URL을 뜻합니다. Open API를 지속적으로 호출하여 변경사항을 체크하는 방법(polling)과 비교하여 불필요한 호출 없이 eformsign 상의 이벤트에 대한 정보를 얻을 수 있습니다.</p>
</div>
<div class="section" id="id1">
<h2>시작하기<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="webhook">
<span id="id2"></span><h3>Webhook 키 발급하기<a class="headerlink" href="#webhook" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>eformsign에 대표 관리자로 로그인 후, 메뉴 트리에서 <strong>[커넥트] &gt; [API / Webhook]</strong> 페이지로 이동합니다.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/apikey1.PNG"><img alt="커넥트 &gt; API/Webhook 메뉴 위치" src="../_images/apikey1.PNG" style="width: 700px;" /></a>
<ol class="arabic simple" start="2">
<li><p><strong>[Webhook 관리]</strong> 탭을 선택하고 <strong>Webhook 추가</strong> 버튼을 클릭합니다.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/webhook2.PNG"><img alt="Webhook 추가 버튼" src="../_images/webhook2.PNG" style="width: 700px;" /></a>
<ol class="arabic simple" start="3">
<li><p>Webhook 키 생성 팝업창에 이름, Webhook URL, 활성 상태, 적용 템플릿을 입력하고 등록 버튼을 클릭합니다.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/webhook3.PNG"><img alt="Webhook 키 생성 팝업창" src="../_images/webhook3.PNG" style="width: 700px;" /></a>
<ol class="arabic simple" start="4">
<li><p>생성된 Webhook 목록에서 <strong>키보기</strong> 버튼을 클릭하여 Webhook 공개키를 확인합니다.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/webhook4.PNG"><img alt="Webhook 키보기 버튼 위치" src="../_images/webhook4.PNG" style="width: 700px;" /></a>
<a class="reference internal image-reference" href="../_images/webhook5.PNG"><img alt="Webhook 키 확인" src="../_images/webhook5.PNG" style="width: 700px;" /></a>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><strong>키 재발행</strong> 버튼을 클릭하면 해당 Webhook의 공개 키가 재발행되며, 이전의 키는 사용할 수 없게 됩니다.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Webhook 정보 수정 방법</strong></p>
<p>생성된 Webhook 목록에서 <strong>수정</strong> 버튼을 클릭하여 Webhook 정보를 변경할 수 있습니다.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Webhook 삭제 방법</strong></p>
<p>생성된 Webhook 목록에서 <strong>삭제</strong> 버튼을 클릭하여 Webhook을 삭제할 수 있습니다.</p>
</div>
<ol class="arabic simple" start="5">
<li><p>생성된 Webhook 리스트에서 <strong>테스트</strong> 버튼을 클릭하면 테스트 Webhook을 전송하고 결과를 반환합니다.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/webhook6.PNG"><img alt="Webhook 테스트 확인" src="../_images/webhook6.PNG" style="width: 700px;" /></a>
<p>다음은 테스트를 위한 json 파일입니다.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>{
&quot;webhook_id&quot; : &quot;해당 Webhook ID&quot;,
&quot;webhook_name&quot; : &quot;해당 Webhook 이름&quot;,
&quot;company_id&quot; : &quot;회사의 ID&quot;,
&quot;event_type&quot; : “document”,
&quot;document&quot; : {
  &quot;id&quot; : “test_doc_id”,
   &quot;template_id&quot; : “test_template_id”,
   &quot;template_version&quot; : “1”,
   &quot;document_history_id&quot; : “test_document_history_id”,
   &quot;doc_status&quot; : “doc_create”,
   &quot;editor_id&quot; : &quot;사용자 ID&quot;,
   &quot;updated_date&quot; : &quot;현재 시간(UTC Long)&quot;
}
}
Test URL : 해당 Webhook의 URL
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h2>서명 생성하기<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>서명 생성 방법에 대해서는  Java, Python, PHP 언어별로 설명합니다.</p>
<div class="section" id="java">
<h3>Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h3>
<p>eformsign 서버로부터 전달받은 이벤트 정보를 <a class="reference external" href="#webhook">Webhook Key 발급하기</a>에서 발급받은 public key로 검증하여 eformsign에서 정상적으로 호출한 이벤트인지에 대한 검증을 진행합니다.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>서명 알고리즘은 SHA256withECDSA을 사용합니다.</p>
</div>
</div>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>키 포맷 처리용 라이브러리를 사용해야 합니다. 작업전 다음의 명령어를 통해 해당 라이브러리를 설치하세요.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">warner</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">ecdsa</span><span class="o">/</span><span class="n">archive</span><span class="o">/</span><span class="n">master</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
</div>
<div class="section" id="php">
<h3>PHP<a class="headerlink" href="#php" title="Permalink to this headline">¶</a></h3>
<p>다음 예제의 keycheck.inc.php, test.php 파일이 동일한 패스에 위치하게 한 후에 진행해야 합니다.</p>
</div>
<div class="section" id="id4">
<h3>각 언어별 예제<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>다음은 각 언어별 예제입니다.</p>
<div class="code-tabs docutils container">
<div class="code-tab" data-title="java">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.spec.X509EncodedKeySpec</span><span class="p">;</span>

<span class="p">....</span>
<span class="cm">/**</span>
<span class="cm"> *  request에서 header와 body를 읽습니다.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>


<span class="c1">//1. get eformsign signature</span>
<span class="c1">//eformsignSignature는 request header에 담겨 있습니다.</span>
<span class="n">String</span> <span class="n">eformsignSignature</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&quot;eformsign_signature&quot;</span><span class="p">);</span>


<span class="c1">//2. get request body data</span>
<span class="c1">// eformsign signature 검증을 위해 body의 데이터를 String으로 변환 합니다.</span>
<span class="n">String</span> <span class="n">eformsignEventBody</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="n">StringBuilder</span> <span class="n">stringBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
<span class="n">BufferedReader</span> <span class="n">bufferedReader</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inputStream</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">bufferedReader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="p">(</span><span class="n">inputStream</span><span class="p">));</span>
        <span class="kt">char</span><span class="o">[]</span> <span class="n">charBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="mi">128</span><span class="o">]</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">bytesRead</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">bytesRead</span> <span class="o">=</span> <span class="n">bufferedReader</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">charBuffer</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">stringBuilder</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">charBuffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bytesRead</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
 <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
 <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bufferedReader</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">bufferedReader</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
 <span class="p">}</span>
<span class="n">eformsignEventBody</span> <span class="o">=</span> <span class="n">stringBuilder</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>




<span class="c1">//3. publicKey 세팅</span>
<span class="n">String</span> <span class="n">publicKeyHex</span> <span class="o">=</span> <span class="s">&quot;발급 받은 Public Key(String)&quot;</span><span class="p">;</span>
<span class="n">KeyFactory</span> <span class="n">publicKeyFact</span> <span class="o">=</span> <span class="n">KeyFactory</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;EC&quot;</span><span class="p">);</span>
<span class="n">X509EncodedKeySpec</span> <span class="n">x509KeySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">X509EncodedKeySpec</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">publicKeyHex</span><span class="p">,</span><span class="mi">16</span><span class="p">).</span><span class="na">toByteArray</span><span class="p">());</span>
<span class="n">PublicKey</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">publicKeyFact</span><span class="p">.</span><span class="na">generatePublic</span><span class="p">(</span><span class="n">x509KeySpec</span><span class="p">);</span>

<span class="c1">//4. verify</span>
<span class="n">Signature</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">Signature</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;SHA256withECDSA&quot;</span><span class="p">);</span>
<span class="n">signature</span><span class="p">.</span><span class="na">initVerify</span><span class="p">(</span><span class="n">publicKey</span><span class="p">);</span>
<span class="n">signature</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">eformsignEventBody</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="s">&quot;UTF-8&quot;</span><span class="p">));</span>
<span class="k">if</span><span class="p">(</span><span class="n">signature</span><span class="p">.</span><span class="na">verify</span><span class="p">(</span><span class="k">new</span> <span class="n">BigInteger</span><span class="p">(</span><span class="n">eformsignSignature</span><span class="p">,</span><span class="mi">16</span><span class="p">).</span><span class="na">toByteArray</span><span class="p">())){</span>
    <span class="c1">//verify success</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;verify success&quot;</span><span class="p">);</span>
    <span class="cm">/*</span>
<span class="cm">     * 이곳에서 이벤트에 맞는 처리를 진행합니다.</span>
<span class="cm">     */</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="c1">//verify fail</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;verify fail&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div class="code-tab" data-title="Python 3.9.6">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>
        <span class="kn">import</span> <span class="nn">binascii</span>

        <span class="kn">from</span> <span class="nn">ecdsa</span> <span class="kn">import</span> <span class="n">VerifyingKey</span><span class="p">,</span> <span class="n">BadSignatureError</span>
        <span class="kn">from</span> <span class="nn">ecdsa.util</span> <span class="kn">import</span> <span class="n">sigencode_der</span><span class="p">,</span> <span class="n">sigdecode_der</span>
        <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>


        <span class="o">...</span>
        <span class="c1"># request에서 header와 body를 읽습니다.</span>
        <span class="c1"># 1. get eformsign signature</span>
        <span class="c1"># eformsignSignature는 request header에 담겨 있습니다.</span>
        <span class="n">eformsign_signature_str</span><span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;eformsign_signature&#39;</span><span class="p">]</span>
        <span class="n">eformsign_signature</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">eformsign_signature_str</span><span class="p">)</span>


        <span class="c1"># 2. get request body data</span>
        <span class="c1"># eformsign signature 검증을 위해 body의 데이터를 String으로 변환합니다.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>


        <span class="c1"># 3. publicKey 세팅</span>
        <span class="n">publicKeyHex</span> <span class="o">=</span> <span class="s2">&quot;발급받은 public key&quot;</span>
        <span class="n">publickey</span> <span class="o">=</span> <span class="n">VerifyingKey</span><span class="o">.</span><span class="n">from_der</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">publicKeyHex</span><span class="p">))</span>


        <span class="c1"># 4. verify</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">publickey</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">eformsign_signature</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">hashfunc</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">,</span> <span class="n">sigdecode</span><span class="o">=</span><span class="n">sigdecode_der</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;verify success&quot;</span><span class="p">)</span>
                <span class="c1"># 이곳에 이벤트에 맞는 처리를 진행합니다.</span>
        <span class="k">except</span> <span class="n">BadSignatureError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;verify fail&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div><div class="code-tab" data-title="PHP - keycheck.inc.php">
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">eformsignECDSA</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PublicKey</span>
<span class="p">{</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$pem_data</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hex2bin</span><span class="p">(</span><span class="nv">$str</span><span class="p">));</span>
        <span class="nv">$offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$pem</span> <span class="o">=</span> <span class="s2">&quot;-----BEGIN PUBLIC KEY-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nv">$offset</span> <span class="o">&lt;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$pem_data</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$pem</span> <span class="o">=</span> <span class="nv">$pem</span> <span class="o">.</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$pem_data</span><span class="p">,</span> <span class="nv">$offset</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
            <span class="nv">$offset</span> <span class="o">=</span> <span class="nv">$offset</span> <span class="o">+</span> <span class="mi">64</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$pem</span> <span class="o">=</span> <span class="nv">$pem</span> <span class="o">.</span> <span class="s2">&quot;-----END PUBLIC KEY-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">openSslPublicKey</span> <span class="o">=</span> <span class="nb">openssl_get_publickey</span><span class="p">(</span><span class="nv">$pem</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">Verify</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$signature</span><span class="p">,</span> <span class="nv">$publicKey</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">openssl_verify</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$signature</span><span class="p">,</span> <span class="nv">$publicKey</span><span class="o">-&gt;</span><span class="na">openSslPublicKey</span><span class="p">,</span> <span class="nx">OPENSSL_ALGO_SHA256</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div><div class="code-tab" data-title="PHP - test.php">
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/keycheck.inc.php&#39;</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">eformsignECDSA\PublicKey</span><span class="p">;</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;PUBLIC_KEY&#39;</span><span class="p">,</span> <span class="s1">&#39;발급 받은 public key를 넣어주세요.&#39;</span><span class="p">);</span>
<span class="o">...</span>
<span class="cm">/*</span>
<span class="cm"> *  request에서 header와 body를 읽습니다.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>


<span class="c1">//1. get eformsign signature</span>
<span class="c1">//eformsignSignature는 request header에 담겨 있습니다.</span>
<span class="nv">$eformsignSignature</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_eformsign_signature&#39;</span><span class="p">];</span>


<span class="c1">//2. get request body data</span>
<span class="c1">// eformsign signature 검증을 위해 body의 데이터를 읽습니다.</span>
<span class="nv">$eformsignEventBody</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;php://input&#39;</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>


<span class="c1">//3. publicKey 세팅</span>
<span class="nv">$publicKey</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PublicKey</span><span class="p">(</span><span class="nx">PUBLIC_KEY</span><span class="p">);</span>


<span class="c1">//4. verify</span>
<span class="nv">$ret</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$ret</span> <span class="o">=</span> <span class="nx">eformsignECDSA\Verify</span><span class="p">(</span><span class="nx">MESSAGE</span><span class="p">,</span> <span class="nv">$eformsignSignature</span><span class="p">,</span> <span class="nv">$publicKey</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$ret</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s1">&#39;verify success&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="cm">/*</span>
<span class="cm">     * 이곳에서 이벤트에 맞는 처리를 진행합니다.</span>
<span class="cm">     */</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s1">&#39;verify fail&#39;</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>
 <span class="o">...</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
</div></div>
</div>
</div>
<div class="section" id="id5">
<h2>Webhook 제공 리스트<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>다음의 Webhook을 설정하면 해당 이벤트 발생 시 설정한 Webhook endpoint로 변경 정보를 수신할 수 있습니다.</p>
<p>현재 제공 중인 <a class="reference external" href="https://app.swaggerhub.com/apis/eformsign_api/eformsign_API_2.0/Webhook">Webhook</a>은 다음과 같습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">POST</span></code>: <a class="reference external" href="https://app.swaggerhub.com/apis/eformsign_api/eformsign_API_2.0/Webhook#/default/post-webhook-document-event">/webhook document event</a> 웹훅 전송</p>
<p>각 eformsign Webhook에 대한 자세한 설명은
<a class="reference external" href="https://app.swaggerhub.com/apis/eformsign_api/eformsign_API_2.0/Webhook">다음</a>에서 확인하실 수 있습니다.</p>
</div>
<div class="section" id="id7">
<h2>Webhook 관련 정보<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>eformsign은 Webhook 이벤트로 <strong>문서</strong> 이벤트와 <strong>PDF 생성</strong> 이벤트를 제공하고 있습니다.</p>
<div class="section" id="id8">
<h3>문서 이벤트<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>eformsign에서 문서의 생성 또는 상태 변경 시 발생하는 이벤트입니다.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 16%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>설명</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>String</p></td>
<td><p>문서 ID</p></td>
</tr>
<tr class="row-odd"><td><p>template_id</p></td>
<td><p>String</p></td>
<td><p>템플릿 ID</p></td>
</tr>
<tr class="row-even"><td><p>template_name</p></td>
<td><p>String</p></td>
<td><p>템플릿 명</p></td>
</tr>
<tr class="row-odd"><td><p>template_version</p></td>
<td><p>String</p></td>
<td><p>템플릿 제목</p></td>
</tr>
<tr class="row-even"><td><p>workflow_seq</p></td>
<td><p>int</p></td>
<td><p>워크플로우 순서</p></td>
</tr>
<tr class="row-odd"><td><p>workflow_name</p></td>
<td><p>String</p></td>
<td><p>워크플로우 명칭</p></td>
</tr>
<tr class="row-even"><td><p>history_id</p></td>
<td><p>String</p></td>
<td><p>문서 히스토리 ID</p></td>
</tr>
<tr class="row-odd"><td><p>status</p></td>
<td><p>String</p></td>
<td><p>문서 상태</p></td>
</tr>
<tr class="row-even"><td><p>editor_id</p></td>
<td><p>String</p></td>
<td><p>작성자 ID</p></td>
</tr>
<tr class="row-odd"><td><p>updated_date</p></td>
<td><p>long</p></td>
<td><p>문서 변경시간</p></td>
</tr>
</tbody>
</table>
<p>이벤트 데이터 중 문서 상태를 나타내는 status의 의미는 다음을 참조하세요.</p>
<table class="docutils align-default" id="status">
<colgroup>
<col style="width: 59%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>설명</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>doc_create</p></td>
<td><p>문서 생성시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_tempsave</p></td>
<td><p>문서 임시 저장시</p></td>
</tr>
<tr class="row-even"><td><p>doc_request_approval</p></td>
<td><p>결재 요청시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_accept_approval</p></td>
<td><p>결재 승인시</p></td>
</tr>
<tr class="row-even"><td><p>doc_reject_approval</p></td>
<td><p>결재 반려시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_request_external</p></td>
<td><p>외부자 요청시</p></td>
</tr>
<tr class="row-even"><td><p>doc_remind_external</p></td>
<td><p>외부자 재 요청시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_open_external</p></td>
<td><p>외부자 열람시</p></td>
</tr>
<tr class="row-even"><td><p>doc_accept_external</p></td>
<td><p>외부자 승인시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_reject_external</p></td>
<td><p>외부자 반려시</p></td>
</tr>
<tr class="row-even"><td><p>doc_request_internal</p></td>
<td><p>내부자 요청시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_accept_internal</p></td>
<td><p>내부자 승인시</p></td>
</tr>
<tr class="row-even"><td><p>doc_reject_internal</p></td>
<td><p>내부자 반려시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_tempsave_internal</p></td>
<td><p>내부자 임시 저장시</p></td>
</tr>
<tr class="row-even"><td><p>doc_cancel_request</p></td>
<td><p>요청 취소시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_reject_request</p></td>
<td><p>반려 요청시</p></td>
</tr>
<tr class="row-even"><td><p>doc_decline_cancel_request</p></td>
<td><p>반려 요청 거절시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_delete_request</p></td>
<td><p>삭제 요청시</p></td>
</tr>
<tr class="row-even"><td><p>doc_decline_delete_request</p></td>
<td><p>삭제 요청 거절시</p></td>
</tr>
<tr class="row-odd"><td><p>doc_deleted</p></td>
<td><p>문서 삭제시</p></td>
</tr>
<tr class="row-even"><td><p>doc_complete</p></td>
<td><p>문서 완료시</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pdf">
<h3>PDF 생성 이벤트<a class="headerlink" href="#pdf" title="Permalink to this headline">¶</a></h3>
<p>eformsign에서 문서의 PDF 파일이 생성될 때 발생하는 이벤트입니다.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 49%" />
<col style="width: 14%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>설명</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>document_id</p></td>
<td><p>String</p></td>
<td><p>문서 ID</p></td>
</tr>
<tr class="row-odd"><td><p>template_id</p></td>
<td><p>String</p></td>
<td><p>템플릿 ID</p></td>
</tr>
<tr class="row-even"><td><p>template_name</p></td>
<td><p>String</p></td>
<td><p>템플릿 명</p></td>
</tr>
<tr class="row-odd"><td><p>template_version</p></td>
<td><p>String</p></td>
<td><p>템플릿 제목</p></td>
</tr>
<tr class="row-even"><td><p>workflow_seq</p></td>
<td><p>int</p></td>
<td><p>워크플로우 순서</p></td>
</tr>
<tr class="row-odd"><td><p>workflow_name</p></td>
<td><p>String</p></td>
<td><p>워크플로우 명칭</p></td>
</tr>
<tr class="row-even"><td><p>document_history_id</p></td>
<td><p>String</p></td>
<td><p>문서 히스토리 ID</p></td>
</tr>
<tr class="row-odd"><td><p>document_status</p></td>
<td><p>String</p></td>
<td><p>문서 상태</p></td>
</tr>
</tbody>
</table>
<p>이벤트 데이터 중 문서 상태를 나타내는 status의 의미는 <a class="reference external" href="#status">다음</a>을 참조하세요.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="eformsign_api.html" class="btn btn-neutral float-left" title="eformsign API 사용하기" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021. FORCS CO., LTD. All rights reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>